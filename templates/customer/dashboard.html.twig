{% extends 'layout/customer_layout.html.twig' %}

{% block title %}my dashboard{% endblock %}

{% block main %}

    <!-- Flash messages -->
        {% for label, messages in app.flashes(['success', 'warning', 'error']) %}
            {% for message in messages %}
                <div class="flash-{{ label }}">
                    {{ message }}
                </div>
            {% endfor %}
        {% endfor %}
    
    <!-- Contenu principal -->
    <div class=" mx-auto pt-6 ">
        
        <!-- Grille d'icônes -->
        <section class="grid grid-cols-1 p-4 sm:grid-cols-2 md:grid-cols-3  gap-6 mb-8">
            <div class="bg-white p-6 shadow-md rounded-lg text-center">
                <span class="text-blue-500 text-4xl">🛒</span>
                <h2 class="text-lg font-semibold mt-2">Commandes en cours : {{ orders|filter(order => order.status != 'Livré')|length }}</h2>
            </div>
            <div class="bg-white p-6 shadow-md rounded-lg text-center">
                <span class="text-green-500 text-4xl">💳</span>
                <h2 class="text-lg font-semibold mt-2">Paiement en attente : {{ orders|filter(order => order.paymentStatus == 'en attente')|length }} </h2>
            </div>
            <div class="bg-white p-6 shadow-md rounded-lg text-center">
                <span class="text-gray-500 text-4xl">📍</span>
                <h2 class="text-lg font-semibold mt-2">Adresse de Livraison : {{ address.city|default('⚠️ A Renseigner') }}</h2>
            </div>
        </section>
        
        <!-- Aperçu des commandes -->
        <section class="bg-white p-6 shadow-md rounded-lg">
            <h2 class="text-xl font-semibold mb-4">Historique des commandes</h2>
       <table class="w-full text-left border-collapse">
    <thead>
        <tr class="border-b">
            <th class="p-2">Date</th>
               <th class="p-2">Référence</th>
            <th class="p-2">Montant</th>
            <th class="p-2">Statut</th>
            <th class="p-2">Payment</th>
            <th class="p-2">Action</th>
        </tr>
    </thead>
    <tbody>
        {% for order in orders|slice(0,5) %}
            <tr class="border-b">
                <td class="p-2">{{ order.createdAt|date('d/m/Y') }}</td>
                <td class="p-2">{{ order.reference }}</td>
                <td class="p-2">{{ order.totalAmount|number_format(2, ',', ' ') }}€</td>
              
                <td class="py-4 text-sm">
                    <span class="px-3 py-1 text-xs font-semibold {{ order.status.getBadgeClass() }} rounded-full">
                        {{ order.status.getLabel() }}
                    </span>
                </td>
                <td class="py-4 text-sm">
                    <span class="px-3 py-1 text-xs font-semibold {{ order.paymentStatus.getBadgeClass() }} rounded-full">
                        {{ order.paymentStatus.getLabel() }}
                    </span>
                </td>

                 <td class="p-2">
                    {% if order.paymentStatus.getLabel is same as('En attente')%}
                       <a href="{{ path('app_order_details', {'id' : order.id })}}">PAYER</a>
                    {% endif %}
                 </td>
            </tr>
        {% endfor %}
    </tbody>
</table>
        </section>
    
        </div>

{% endblock %}
